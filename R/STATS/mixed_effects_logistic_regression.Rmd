---
title: "Mixed Effects Logistic Regressions"
output:
  html_document:
    df_print: paged
    code_folding: hide
---
```{r}
library(data.table)
library(ggplot2)
source("../REF_FUNCTIONS/process.r")
```

```{r}
DATA_FOLDER <- '/home/adrian/SingleCP_DotsReversal/Fall2019/raw/'
```

```{r}
#t1 <- fread(paste0(DATA_FOLDER, 'completed4AFCtrials_task99_date_2019_11_05_10_27.csv'))
full_data <- get_full_data(paste0(DATA_FOLDER, 'full_2019_12_02.csv'))
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

What viewing duration has the most data?

```{r}
ggplot(full_data[,.(numTrials=.N), by=.(subject, duration, probCP, presenceCP)], aes(x=duration, y=numTrials, col=presenceCP)) + 
  geom_point() + 
  facet_grid(subject~probCP) +
  scale_color_manual(values=c(cbbPalette[8], cbbPalette[6]))
```
Let's stick to 200 msec for now.
```{r}
full_data <- full_data[duration == 200]
```

```{r}
full_data[, scoh := coherence]
full_data[direction=="left", scoh := -coherence]
```

Now, let's plot the raw data per subject, per probCP (i.e. session). 

```{r}
psychom <- full_data[, `:=`(propChoseR=sum(dirChoice=="right")/.N, trialCount=.N), by=.(subject, probCP, scoh)]
psychom[,dataCount:="<5"]
psychom[trialCount >= 5 & trialCount < 10, dataCount:="<10"]
psychom[trialCount >= 10 & trialCount < 20, dataCount:="<20"]
psychom[trialCount >= 20, dataCount:=">=20"]
psychom[,dataCount := factor(dataCount, levels=c("<5", "<10", "<20", ">=20"))]
```

```{r, fig.width=7, fig.height=7}
ggplot(psychom, aes(x=scoh, y=propChoseR)) + 
  geom_point(size=3, aes(shape=dataCount)) +
  geom_hline(yintercept = c(0,.5,1), linetype='dashed') +
  facet_grid(subject~probCP) +
  theme(text=element_text(size=17))
```

