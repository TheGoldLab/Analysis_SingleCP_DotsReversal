---
title: "Dots Reproducibility Test"
output:
  html_document:
    df_print: paged
    code_folding: hide
---
# Frame count variability
10 trials of 200msec, followed by 10 trials of 400msec were run, all with the same random seed.
```{r}
library(data.table)
library(ggplot2)
# source("explore_functions.r")
```

```{r}
path_to_fira <- "/home/adrian/SingleCP_DotsReversal/DotsReproducibilityTest/raw/2019_09_23_14_49/2019_09_23_14_49_FIRA.csv"
path_to_dots <- "/home/adrian/SingleCP_DotsReversal/DotsReproducibilityTest/raw/2019_09_23_14_49/2019_09_23_14_49_dotsPositions.csv"
```

```{r}
fira <- fread(path_to_fira)
dots <- fread(path_to_dots)
```

```{r}
dots[,trial:=factor(seqDumpTime, ordered=T)]
dotsTrials <- length(levels(dots$trial))
if (dotsTrials == max(fira$trialIndex)) {
  levels(dots$trial) <- seq(dotsTrials)
}
```

```{r}
str(dots)
```

Are frames counted without holes?
```{r}
frames <- unique(dots[,.(frameIdx), by=trial])
frameCounts <- frames[,.(maxFrames=max(frameIdx), numFrames=.N), by=trial]
frameCounts[,type:='short']
frameCounts[trial>10,type:='long']
frameCounts[,type:=as.factor(type)]
```

```{r}
noholes<-prod(frameCounts$maxFrames == frameCounts$numFrames)
if (noholes) {print("no holes!")}
```

```{r}
frameCounts[,reltrial:=as.integer(seq(dotsTrials / 2)), by=type]
```

```{r, fig.width=10, fig.height=6}
ggplot(frameCounts, aes(x=reltrial, y=numFrames, color=type)) + 
  geom_point(size=4) +
  scale_y_continuous(breaks = seq(10, 30, 1)) +
  theme(text=element_text(size=20),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line(colour = "white",size=0.75))
```
# Dots position variability
On a single frame, each dot is represented by its (x.y) coordinates. Dots positions should be equal across trials, for a fixed frame number.
```{r}
dots_dt <- dots[isActive == 1, .(xpos, ypos, trial, frameIdx)]
dots_dt[,dotID:=seq(.N), by=.(trial, frameIdx)]
str(dots_dt)
```

```{r}
head(dots_dt)
```

```{r, fig.width=100, fig.height=60}
# ggplot(dots_dt, aes(x=xpos, y=ypos)) + geom_point() + facet_grid(trial~frameIdx) + theme(text=element_text(size=20))
```

